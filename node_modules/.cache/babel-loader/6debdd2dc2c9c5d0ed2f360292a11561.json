{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{deleteCart,updateCart}from'../Redux/Action/ActionCart';import ListCart from'./Component/ListCart';import alertify from'alertifyjs';import{Link,Redirect}from'react-router-dom';import CartAPI from'../API/CartAPI';import queryString from'query-string';import convertMoney from'../convertMoney';function Cart(props){//id_user được lấy từ redux\nvar id_user=useSelector(function(state){return state.Cart.id_user;});//listCart được lấy từ redux\nvar listCart=useSelector(function(state){return state.Cart.listCart;});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),cart=_useState2[0],setCart=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),total=_useState4[0],setTotal=_useState4[1];var dispatch=useDispatch();//State dùng để Load dữ liệu từ Redux\nvar _useState5=useState({idProduct:'',count:''}),_useState6=_slicedToArray(_useState5,2),loadRedux=_useState6[0],setLoadRedux=_useState6[1];//State dùng để Load dữ liệu từ API\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loadAPI=_useState8[0],setLoadAPI=_useState8[1];//Hàm này dùng để Load dữ liệu ở Redux\n//Khi người dùng chưa đăng nhập\n// useEffect(() => {\n//   console.log(id_user);\n//   const fetchDataRedux = () => {\n//     if (!localStorage.getItem('id_user')) {\n//       setCart(listCart);\n//       getTotal(listCart);\n//     }\n//   };\n//   fetchDataRedux();\n// }, [loadRedux]);\n//Hàm này dùng để tính tổng tiền carts\nfunction getTotal(carts){var sub_total=0;var sum_total=carts.map(function(value){return sub_total+=parseInt(value.productId.price)*parseInt(value.quantity);});setTotal(sub_total);}//Hàm này dùng để load dữ liệu từ API\n//Khi người dùng đã đăng nhập\nuseEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,query,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!localStorage.getItem('id_user')){_context.next=11;break;}params={idUser:localStorage.getItem('id_user')};query='?'+queryString.stringify(params);console.log(query);_context.next=6;return CartAPI.getCarts(query);case 6:response=_context.sent;console.log(response);if(response.data.error){alertify.set('notifier','position','bottom-left');alertify.error('Your must signin to use your cart!');}else{setCart(response.data.products);getTotal(response.data.products);}_context.next=13;break;case 11:alertify.set('notifier','position','bottom-left');alertify.error('Your must signin to use your cart!');case 13:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();setLoadAPI(false);},[loadAPI]);//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\nvar onDeleteCart=function onDeleteCart(getProduct){console.log(getProduct);if(localStorage.getItem('id_user')){// user đã đăng nhập\n//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\nvar fetchDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,query,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params={idProduct:getProduct};query='?'+queryString.stringify(params);_context2.next=4;return CartAPI.deleteToCart(query);case 4:response=_context2.sent;if(response.data.error){alertify.set('notifier','position','bottom-left');alertify.error('Your must signin to use your cart!');}else{console.log(response);alertify.set('notifier','position','bottom-left');alertify.error('Bạn Đã Xóa Hàng Thành Công!');}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchDelete(){return _ref2.apply(this,arguments);};}();fetchDelete();//Sau đó thay đổi state loadAPI và load lại hàm useEffect\nsetLoadAPI(true);}else{// user chưa đăng nhập\n//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\nvar data={idProduct:getProduct// idUser: getUser,\n};//Đưa dữ liệu vào Redux\nvar action=deleteCart(data);dispatch(action);alertify.set('notifier','position','bottom-left');alertify.error('Bạn Đã Xóa Hàng Thành Công!');//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\nsetLoadRedux({idProduct:getProduct,count:''});}};//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\nvar onUpdateCount=function onUpdateCount(getProduct,getCount){console.log('Count: '+getCount+', idProduct: '+getProduct);if(localStorage.getItem('id_user')){// user đã đăng nhập\n//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\nvar fetchPut=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var params,query,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:params={//   idUser: getUser,\nidProduct:getProduct,count:getCount};query='?'+queryString.stringify(params);_context3.next=4;return CartAPI.putToCart(query);case 4:response=_context3.sent;if(response.data.error){alertify.set('notifier','position','bottom-left');alertify.error('Your must signin to use your cart!');}else{console.log(response);alertify.set('notifier','position','bottom-left');alertify.success('Bạn Đã Sửa Hàng Thành Công!');}case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchPut(){return _ref3.apply(this,arguments);};}();fetchPut();//Sau đó thay đổi state loadAPI và load lại hàm useEffect\nsetLoadAPI(true);}else{//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\nvar data={idProduct:getProduct,// idUser: getUser,\ncount:getCount};//Đưa dữ liệu vào Redux\nvar action=updateCart(data);dispatch(action);alertify.set('notifier','position','bottom-left');alertify.success('Bạn Đã Sửa Hàng Thành Công!');//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\nsetLoadRedux({idProduct:getProduct,count:getCount});}};//Hàm này dùng để redirect đến page checkout\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),redirect=_useState10[0],setRedirect=_useState10[1];var onCheckout=function onCheckout(){if(!localStorage.getItem('id_user')){alertify.set('notifier','position','bottom-left');alertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');return;}if(cart.length===0){alertify.set('notifier','position','bottom-left');alertify.error('Vui Lòng Kiểm Tra Lại Giỏ Hàng!');return;}setRedirect(true);};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"section\",{className:\"py-5 bg-light\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row px-4 px-lg-5 py-lg-4 align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"h2 text-uppercase mb-0\",children:\"Cart\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6 text-lg-right\",children:/*#__PURE__*/_jsx(\"nav\",{\"aria-label\":\"breadcrumb\",children:/*#__PURE__*/_jsx(\"ol\",{className:\"breadcrumb justify-content-lg-end mb-0 px-0\",children:/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item active\",\"aria-current\":\"page\",children:\"Cart\"})})})})]})})}),/*#__PURE__*/_jsxs(\"section\",{className:\"py-5\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"h5 text-uppercase mb-4\",children:\"Shopping cart\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-8 mb-4 mb-lg-0\",children:[/*#__PURE__*/_jsx(ListCart,{listCart:cart,onDeleteCart:onDeleteCart,onUpdateCount:onUpdateCount}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-light px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row align-items-center text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-3 mb-md-0 text-md-left\",children:/*#__PURE__*/_jsxs(Link,{className:\"btn btn-link p-0 text-dark btn-sm\",to:\"/shop\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-long-arrow-alt-left mr-2\",children:\" \"}),\"Continue shopping\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 text-md-right\",children:[redirect&&/*#__PURE__*/_jsx(Redirect,{to:'/checkout'}),/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-outline-dark btn-sm\",onClick:onCheckout,children:[\"Proceed to checkout\",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-long-arrow-alt-right ml-2\"})]})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card border-0 rounded-0 p-lg-4 bg-light\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-uppercase mb-4\",children:\"Cart total\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-unstyled mb-0\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-uppercase small font-weight-bold\",children:\"Subtotal\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-muted small\",children:[convertMoney(total),\" VND\"]})]}),/*#__PURE__*/_jsx(\"li\",{className:\"border-bottom my-2\"}),/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between mb-4\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-uppercase small font-weight-bold\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[convertMoney(total),\" VND\"]})]})]})]})})})]})]})]});}export default Cart;","map":{"version":3,"sources":["D:/Documents/node/asm3/Frontend Assignment 03/src/Cart/Cart.jsx"],"names":["React","useEffect","useState","useDispatch","useSelector","deleteCart","updateCart","ListCart","alertify","Link","Redirect","CartAPI","queryString","convertMoney","Cart","props","id_user","state","listCart","cart","setCart","total","setTotal","dispatch","idProduct","count","loadRedux","setLoadRedux","loadAPI","setLoadAPI","getTotal","carts","sub_total","sum_total","map","value","parseInt","productId","price","quantity","fetchData","localStorage","getItem","params","idUser","query","stringify","console","log","getCarts","response","data","error","set","products","onDeleteCart","getProduct","fetchDelete","deleteToCart","action","onUpdateCount","getCount","fetchPut","putToCart","success","redirect","setRedirect","onCheckout","length"],"mappings":"ikBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,UAAT,CAAqBC,UAArB,KAAuC,4BAAvC,CACA,MAAOC,CAAAA,QAAP,KAAqB,sBAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,OAASC,IAAT,CAAeC,QAAf,KAA+B,kBAA/B,CACA,MAAOC,CAAAA,OAAP,KAAoB,gBAApB,CACA,MAAOC,CAAAA,WAAP,KAAwB,cAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,iBAAzB,CAEA,QAASC,CAAAA,IAAT,CAAcC,KAAd,CAAqB,CACnB;AACA,GAAMC,CAAAA,OAAO,CAAGZ,WAAW,CAAC,SAACa,KAAD,QAAWA,CAAAA,KAAK,CAACH,IAAN,CAAWE,OAAtB,EAAD,CAA3B,CAEA;AACA,GAAME,CAAAA,QAAQ,CAAGd,WAAW,CAAC,SAACa,KAAD,QAAWA,CAAAA,KAAK,CAACH,IAAN,CAAWI,QAAtB,EAAD,CAA5B,CALmB,cAOKhB,QAAQ,CAAC,EAAD,CAPb,wCAOZiB,IAPY,eAONC,OAPM,8BASOlB,QAAQ,EATf,yCASZmB,KATY,eASLC,QATK,eAWnB,GAAMC,CAAAA,QAAQ,CAAGpB,WAAW,EAA5B,CAEA;AAbmB,eAceD,QAAQ,CAAC,CACzCsB,SAAS,CAAE,EAD8B,CAEzCC,KAAK,CAAE,EAFkC,CAAD,CAdvB,yCAcZC,SAdY,eAcDC,YAdC,eAmBnB;AAnBmB,eAoBWzB,QAAQ,CAAC,KAAD,CApBnB,yCAoBZ0B,OApBY,eAoBHC,UApBG,eAsBnB;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA,QAASC,CAAAA,QAAT,CAAkBC,KAAlB,CAAyB,CACvB,GAAIC,CAAAA,SAAS,CAAG,CAAhB,CAEA,GAAMC,CAAAA,SAAS,CAAGF,KAAK,CAACG,GAAN,CAAU,SAACC,KAAD,CAAW,CACrC,MAAQH,CAAAA,SAAS,EACfI,QAAQ,CAACD,KAAK,CAACE,SAAN,CAAgBC,KAAjB,CAAR,CAAkCF,QAAQ,CAACD,KAAK,CAACI,QAAP,CAD5C,CAED,CAHiB,CAAlB,CAKAjB,QAAQ,CAACU,SAAD,CAAR,CACD,CAED;AACA;AACA/B,SAAS,CAAC,UAAM,CACd,GAAMuC,CAAAA,SAAS,0FAAG,iKACZC,YAAY,CAACC,OAAb,CAAqB,SAArB,CADY,0BAERC,MAFQ,CAEC,CACbC,MAAM,CAAEH,YAAY,CAACC,OAAb,CAAqB,SAArB,CADK,CAFD,CAMRG,KANQ,CAMA,IAAMjC,WAAW,CAACkC,SAAZ,CAAsBH,MAAtB,CANN,CAQdI,OAAO,CAACC,GAAR,CAAYH,KAAZ,EARc,sBAUSlC,CAAAA,OAAO,CAACsC,QAAR,CAAiBJ,KAAjB,CAVT,QAURK,QAVQ,eAWdH,OAAO,CAACC,GAAR,CAAYE,QAAZ,EACA,GAAIA,QAAQ,CAACC,IAAT,CAAcC,KAAlB,CAAyB,CACvB5C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,oCAAf,EACD,CAHD,IAGO,CACLhC,OAAO,CAAC8B,QAAQ,CAACC,IAAT,CAAcG,QAAf,CAAP,CAEAxB,QAAQ,CAACoB,QAAQ,CAACC,IAAT,CAAcG,QAAf,CAAR,CACD,CAnBa,+BAqBd9C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,oCAAf,EAtBc,uDAAH,kBAATZ,CAAAA,SAAS,0CAAf,CA0BAA,SAAS,GAETX,UAAU,CAAC,KAAD,CAAV,CACD,CA9BQ,CA8BN,CAACD,OAAD,CA9BM,CAAT,CAgCA;AACA,GAAM2B,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,UAAD,CAAgB,CACnCT,OAAO,CAACC,GAAR,CAAYQ,UAAZ,EAEA,GAAIf,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAJ,CAAqC,CACnC;AAEA;AACA,GAAMe,CAAAA,WAAW,2FAAG,kKACZd,MADY,CACH,CACbnB,SAAS,CAAEgC,UADE,CADG,CAKZX,KALY,CAKJ,IAAMjC,WAAW,CAACkC,SAAZ,CAAsBH,MAAtB,CALF,wBAOKhC,CAAAA,OAAO,CAAC+C,YAAR,CAAqBb,KAArB,CAPL,QAOZK,QAPY,gBAQlB,GAAIA,QAAQ,CAACC,IAAT,CAAcC,KAAlB,CAAyB,CACvB5C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,oCAAf,EACD,CAHD,IAGO,CACLL,OAAO,CAACC,GAAR,CAAYE,QAAZ,EACA1C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,6BAAf,EACD,CAfiB,wDAAH,kBAAXK,CAAAA,WAAW,2CAAjB,CAkBAA,WAAW,GAEX;AACA5B,UAAU,CAAC,IAAD,CAAV,CACD,CA1BD,IA0BO,CACL;AAEA;AACA,GAAMsB,CAAAA,IAAI,CAAG,CACX3B,SAAS,CAAEgC,UACX;AAFW,CAAb,CAKA;AACA,GAAMG,CAAAA,MAAM,CAAGtD,UAAU,CAAC8C,IAAD,CAAzB,CACA5B,QAAQ,CAACoC,MAAD,CAAR,CAEAnD,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,6BAAf,EAEA;AACAzB,YAAY,CAAC,CACXH,SAAS,CAAEgC,UADA,CAEX/B,KAAK,CAAE,EAFI,CAAD,CAAZ,CAID,CACF,CAnDD,CAqDA;AACA,GAAMmC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACJ,UAAD,CAAaK,QAAb,CAA0B,CAC9Cd,OAAO,CAACC,GAAR,CAAY,UAAYa,QAAZ,CAAuB,eAAvB,CAAyCL,UAArD,EAEA,GAAIf,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAJ,CAAqC,CACnC;AAEA;AACA,GAAMoB,CAAAA,QAAQ,2FAAG,kKACTnB,MADS,CACA,CACb;AACAnB,SAAS,CAAEgC,UAFE,CAGb/B,KAAK,CAAEoC,QAHM,CADA,CAOThB,KAPS,CAOD,IAAMjC,WAAW,CAACkC,SAAZ,CAAsBH,MAAtB,CAPL,wBASQhC,CAAAA,OAAO,CAACoD,SAAR,CAAkBlB,KAAlB,CATR,QASTK,QATS,gBAUf,GAAIA,QAAQ,CAACC,IAAT,CAAcC,KAAlB,CAAyB,CACvB5C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,oCAAf,EACD,CAHD,IAGO,CACLL,OAAO,CAACC,GAAR,CAAYE,QAAZ,EACA1C,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAACwD,OAAT,CAAiB,6BAAjB,EACD,CAjBc,wDAAH,kBAARF,CAAAA,QAAQ,2CAAd,CAoBAA,QAAQ,GAER;AACAjC,UAAU,CAAC,IAAD,CAAV,CACD,CA5BD,IA4BO,CACL;AACA,GAAMsB,CAAAA,IAAI,CAAG,CACX3B,SAAS,CAAEgC,UADA,CAEX;AACA/B,KAAK,CAAEoC,QAHI,CAAb,CAMA;AACA,GAAMF,CAAAA,MAAM,CAAGrD,UAAU,CAAC6C,IAAD,CAAzB,CACA5B,QAAQ,CAACoC,MAAD,CAAR,CAEAnD,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAACwD,OAAT,CAAiB,6BAAjB,EAEA;AACArC,YAAY,CAAC,CACXH,SAAS,CAAEgC,UADA,CAEX/B,KAAK,CAAEoC,QAFI,CAAD,CAAZ,CAID,CACF,CApDD,CAsDA;AAhMmB,eAiMa3D,QAAQ,CAAC,KAAD,CAjMrB,0CAiMZ+D,QAjMY,gBAiMFC,WAjME,gBAmMnB,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB,GAAI,CAAC1B,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAL,CAAsC,CACpClC,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,kCAAf,EACA,OACD,CAED,GAAIjC,IAAI,CAACiD,MAAL,GAAgB,CAApB,CAAuB,CACrB5D,QAAQ,CAAC6C,GAAT,CAAa,UAAb,CAAyB,UAAzB,CAAqC,aAArC,EACA7C,QAAQ,CAAC4C,KAAT,CAAe,iCAAf,EACA,OACD,CAEDc,WAAW,CAAC,IAAD,CAAX,CACD,CAdD,CAgBA,mBACE,aAAK,SAAS,CAAC,WAAf,wBACE,gBAAS,SAAS,CAAC,eAAnB,uBACE,YAAK,SAAS,CAAC,WAAf,uBACE,aAAK,SAAS,CAAC,6CAAf,wBACE,YAAK,SAAS,CAAC,UAAf,uBACE,WAAI,SAAS,CAAC,wBAAd,kBADF,EADF,cAIE,YAAK,SAAS,CAAC,wBAAf,uBACE,YAAK,aAAW,YAAhB,uBACE,WAAI,SAAS,CAAC,6CAAd,uBACE,WAAI,SAAS,CAAC,wBAAd,CAAuC,eAAa,MAApD,kBADF,EADF,EADF,EAJF,GADF,EADF,EADF,cAmBE,iBAAS,SAAS,CAAC,MAAnB,wBACE,WAAI,SAAS,CAAC,wBAAd,2BADF,cAEE,aAAK,SAAS,CAAC,KAAf,wBACE,aAAK,SAAS,CAAC,uBAAf,wBACE,KAAC,QAAD,EACE,QAAQ,CAAE/C,IADZ,CAEE,YAAY,CAAEoC,YAFhB,CAGE,aAAa,CAAEK,aAHjB,EADF,cAOE,YAAK,SAAS,CAAC,oBAAf,uBACE,aAAK,SAAS,CAAC,oCAAf,wBACE,YAAK,SAAS,CAAC,oCAAf,uBACE,MAAC,IAAD,EACE,SAAS,CAAC,mCADZ,CAEE,EAAE,QAFJ,wBAIE,UAAG,SAAS,CAAC,iCAAb,eAJF,uBADF,EADF,cAUE,aAAK,SAAS,CAAC,wBAAf,WACGK,QAAQ,eAAI,KAAC,QAAD,EAAU,EAAE,CAAE,WAAd,EADf,cAEE,cACE,SAAS,CAAC,6BADZ,CAEE,OAAO,CAAEE,UAFX,8CAKE,UAAG,SAAS,CAAC,kCAAb,EALF,GAFF,GAVF,GADF,EAPF,GADF,cAgCE,YAAK,SAAS,CAAC,UAAf,uBACE,YAAK,SAAS,CAAC,yCAAf,uBACE,aAAK,SAAS,CAAC,WAAf,wBACE,WAAI,SAAS,CAAC,qBAAd,wBADF,cAEE,YAAI,SAAS,CAAC,oBAAd,wBACE,YAAI,SAAS,CAAC,mDAAd,wBACE,eAAQ,SAAS,CAAC,uCAAlB,sBADF,cAIE,cAAM,SAAS,CAAC,kBAAhB,WACGtD,YAAY,CAACQ,KAAD,CADf,UAJF,GADF,cASE,WAAI,SAAS,CAAC,oBAAd,EATF,cAUE,YAAI,SAAS,CAAC,wDAAd,wBACE,eAAQ,SAAS,CAAC,uCAAlB,mBADF,cAIE,wBAAOR,YAAY,CAACQ,KAAD,CAAnB,UAJF,GAVF,GAFF,GADF,EADF,EAhCF,GAFF,GAnBF,GADF,CAkFD,CAED,cAAeP,CAAAA,IAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { deleteCart, updateCart } from '../Redux/Action/ActionCart';\nimport ListCart from './Component/ListCart';\nimport alertify from 'alertifyjs';\nimport { Link, Redirect } from 'react-router-dom';\nimport CartAPI from '../API/CartAPI';\nimport queryString from 'query-string';\nimport convertMoney from '../convertMoney';\n\nfunction Cart(props) {\n  //id_user được lấy từ redux\n  const id_user = useSelector((state) => state.Cart.id_user);\n\n  //listCart được lấy từ redux\n  const listCart = useSelector((state) => state.Cart.listCart);\n\n  const [cart, setCart] = useState([]);\n\n  const [total, setTotal] = useState();\n\n  const dispatch = useDispatch();\n\n  //State dùng để Load dữ liệu từ Redux\n  const [loadRedux, setLoadRedux] = useState({\n    idProduct: '',\n    count: '',\n  });\n\n  //State dùng để Load dữ liệu từ API\n  const [loadAPI, setLoadAPI] = useState(false);\n\n  //Hàm này dùng để Load dữ liệu ở Redux\n  //Khi người dùng chưa đăng nhập\n  // useEffect(() => {\n  //   console.log(id_user);\n  //   const fetchDataRedux = () => {\n  //     if (!localStorage.getItem('id_user')) {\n  //       setCart(listCart);\n\n  //       getTotal(listCart);\n  //     }\n  //   };\n\n  //   fetchDataRedux();\n  // }, [loadRedux]);\n\n  //Hàm này dùng để tính tổng tiền carts\n  function getTotal(carts) {\n    let sub_total = 0;\n\n    const sum_total = carts.map((value) => {\n      return (sub_total +=\n        parseInt(value.productId.price) * parseInt(value.quantity));\n    });\n\n    setTotal(sub_total);\n  }\n\n  //Hàm này dùng để load dữ liệu từ API\n  //Khi người dùng đã đăng nhập\n  useEffect(() => {\n    const fetchData = async () => {\n      if (localStorage.getItem('id_user')) {\n        const params = {\n          idUser: localStorage.getItem('id_user'),\n        };\n\n        const query = '?' + queryString.stringify(params);\n\n        console.log(query);\n\n        const response = await CartAPI.getCarts(query);\n        console.log(response);\n        if (response.data.error) {\n          alertify.set('notifier', 'position', 'bottom-left');\n          alertify.error('Your must signin to use your cart!');\n        } else {\n          setCart(response.data.products);\n\n          getTotal(response.data.products);\n        }\n      } else {\n        alertify.set('notifier', 'position', 'bottom-left');\n        alertify.error('Your must signin to use your cart!');\n      }\n    };\n\n    fetchData();\n\n    setLoadAPI(false);\n  }, [loadAPI]);\n\n  //Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\n  const onDeleteCart = (getProduct) => {\n    console.log(getProduct);\n\n    if (localStorage.getItem('id_user')) {\n      // user đã đăng nhập\n\n      //Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\n      const fetchDelete = async () => {\n        const params = {\n          idProduct: getProduct,\n        };\n\n        const query = '?' + queryString.stringify(params);\n\n        const response = await CartAPI.deleteToCart(query);\n        if (response.data.error) {\n          alertify.set('notifier', 'position', 'bottom-left');\n          alertify.error('Your must signin to use your cart!');\n        } else {\n          console.log(response);\n          alertify.set('notifier', 'position', 'bottom-left');\n          alertify.error('Bạn Đã Xóa Hàng Thành Công!');\n        }\n      };\n\n      fetchDelete();\n\n      //Sau đó thay đổi state loadAPI và load lại hàm useEffect\n      setLoadAPI(true);\n    } else {\n      // user chưa đăng nhập\n\n      //Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\n      const data = {\n        idProduct: getProduct,\n        // idUser: getUser,\n      };\n\n      //Đưa dữ liệu vào Redux\n      const action = deleteCart(data);\n      dispatch(action);\n\n      alertify.set('notifier', 'position', 'bottom-left');\n      alertify.error('Bạn Đã Xóa Hàng Thành Công!');\n\n      //set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\n      setLoadRedux({\n        idProduct: getProduct,\n        count: '',\n      });\n    }\n  };\n\n  //Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\n  const onUpdateCount = (getProduct, getCount) => {\n    console.log('Count: ' + getCount + ', idProduct: ' + getProduct);\n\n    if (localStorage.getItem('id_user')) {\n      // user đã đăng nhập\n\n      //Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\n      const fetchPut = async () => {\n        const params = {\n          //   idUser: getUser,\n          idProduct: getProduct,\n          count: getCount,\n        };\n\n        const query = '?' + queryString.stringify(params);\n\n        const response = await CartAPI.putToCart(query);\n        if (response.data.error) {\n          alertify.set('notifier', 'position', 'bottom-left');\n          alertify.error('Your must signin to use your cart!');\n        } else {\n          console.log(response);\n          alertify.set('notifier', 'position', 'bottom-left');\n          alertify.success('Bạn Đã Sửa Hàng Thành Công!');\n        }\n      };\n\n      fetchPut();\n\n      //Sau đó thay đổi state loadAPI và load lại hàm useEffect\n      setLoadAPI(true);\n    } else {\n      //Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\n      const data = {\n        idProduct: getProduct,\n        // idUser: getUser,\n        count: getCount,\n      };\n\n      //Đưa dữ liệu vào Redux\n      const action = updateCart(data);\n      dispatch(action);\n\n      alertify.set('notifier', 'position', 'bottom-left');\n      alertify.success('Bạn Đã Sửa Hàng Thành Công!');\n\n      //set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\n      setLoadRedux({\n        idProduct: getProduct,\n        count: getCount,\n      });\n    }\n  };\n\n  //Hàm này dùng để redirect đến page checkout\n  const [redirect, setRedirect] = useState(false);\n\n  const onCheckout = () => {\n    if (!localStorage.getItem('id_user')) {\n      alertify.set('notifier', 'position', 'bottom-left');\n      alertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');\n      return;\n    }\n\n    if (cart.length === 0) {\n      alertify.set('notifier', 'position', 'bottom-left');\n      alertify.error('Vui Lòng Kiểm Tra Lại Giỏ Hàng!');\n      return;\n    }\n\n    setRedirect(true);\n  };\n\n  return (\n    <div className=\"container\">\n      <section className=\"py-5 bg-light\">\n        <div className=\"container\">\n          <div className=\"row px-4 px-lg-5 py-lg-4 align-items-center\">\n            <div className=\"col-lg-6\">\n              <h1 className=\"h2 text-uppercase mb-0\">Cart</h1>\n            </div>\n            <div className=\"col-lg-6 text-lg-right\">\n              <nav aria-label=\"breadcrumb\">\n                <ol className=\"breadcrumb justify-content-lg-end mb-0 px-0\">\n                  <li className=\"breadcrumb-item active\" aria-current=\"page\">\n                    Cart\n                  </li>\n                </ol>\n              </nav>\n            </div>\n          </div>\n        </div>\n      </section>\n      <section className=\"py-5\">\n        <h2 className=\"h5 text-uppercase mb-4\">Shopping cart</h2>\n        <div className=\"row\">\n          <div className=\"col-lg-8 mb-4 mb-lg-0\">\n            <ListCart\n              listCart={cart}\n              onDeleteCart={onDeleteCart}\n              onUpdateCount={onUpdateCount}\n            />\n\n            <div className=\"bg-light px-4 py-3\">\n              <div className=\"row align-items-center text-center\">\n                <div className=\"col-md-6 mb-3 mb-md-0 text-md-left\">\n                  <Link\n                    className=\"btn btn-link p-0 text-dark btn-sm\"\n                    to={`/shop`}\n                  >\n                    <i className=\"fas fa-long-arrow-alt-left mr-2\"> </i>\n                    Continue shopping\n                  </Link>\n                </div>\n                <div className=\"col-md-6 text-md-right\">\n                  {redirect && <Redirect to={'/checkout'} />}\n                  <span\n                    className=\"btn btn-outline-dark btn-sm\"\n                    onClick={onCheckout}\n                  >\n                    Proceed to checkout\n                    <i className=\"fas fa-long-arrow-alt-right ml-2\"></i>\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"col-lg-4\">\n            <div className=\"card border-0 rounded-0 p-lg-4 bg-light\">\n              <div className=\"card-body\">\n                <h5 className=\"text-uppercase mb-4\">Cart total</h5>\n                <ul className=\"list-unstyled mb-0\">\n                  <li className=\"d-flex align-items-center justify-content-between\">\n                    <strong className=\"text-uppercase small font-weight-bold\">\n                      Subtotal\n                    </strong>\n                    <span className=\"text-muted small\">\n                      {convertMoney(total)} VND\n                    </span>\n                  </li>\n                  <li className=\"border-bottom my-2\"></li>\n                  <li className=\"d-flex align-items-center justify-content-between mb-4\">\n                    <strong className=\"text-uppercase small font-weight-bold\">\n                      Total\n                    </strong>\n                    <span>{convertMoney(total)} VND</span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n\nexport default Cart;\n"]},"metadata":{},"sourceType":"module"}