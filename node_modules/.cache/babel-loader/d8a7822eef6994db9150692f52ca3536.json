{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Documents/node/asm3/Frontend Assignment 03/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import queryString from'query-string';import CartAPI from'../API/CartAPI';import CheckoutAPI from'../API/CheckoutAPI';import convertMoney from'../convertMoney';import'./Checkout.css';import io from'socket.io-client';var socket=io('http://localhost:5000');function Checkout(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),carts=_useState2[0],setCarts=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),total=_useState4[0],setTotal=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),fullname=_useState6[0],setFullname=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),fullnameError=_useState8[0],setFullnameError=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),email=_useState10[0],setEmail=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),emailError=_useState12[0],setEmailError=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),emailRegex=_useState14[0],setEmailRegex=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),phone=_useState16[0],setPhone=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),phoneError=_useState18[0],setPhoneError=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),address=_useState20[0],setAddress=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),addressError=_useState22[0],setAddressError=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),success=_useState24[0],setSuccess=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),load=_useState26[0],setLoad=_useState26[1];//Hàm này dùng để gọi API và render số sản phẩm\nuseEffect(function(){if(localStorage.getItem('id_user')){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,query,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params={idUser:localStorage.getItem('id_user')};query='?'+queryString.stringify(params);_context.next=4;return CartAPI.getCarts(query);case 4:response=_context.sent;console.log(response);setCarts(response.data.products);getTotal(response.data.products);if(response.data.products.length===0){window.location.replace('/cart');}case 9:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();}},[]);//Hàm này dùng để tính tổng tiền carts\nfunction getTotal(carts){var sub_total=0;var sum_total=carts.map(function(value){return sub_total+=parseInt(value.productId.price)*parseInt(value.quantity);});setTotal(sub_total);}//Check Validation\nvar handlerSubmit=function handlerSubmit(){if(!fullname){setFullnameError(true);setEmailError(false);setPhoneError(false);setAddressError(false);return;}else{if(!email){setFullnameError(false);setEmailError(true);setPhoneError(false);setAddressError(false);return;}else{setPhoneError(false);setAddressError(false);setFullnameError(false);if(!validateEmail(email)){setEmailRegex(true);setFullnameError(false);setEmailError(false);setPhoneError(false);setAddressError(false);return;}else{setEmailRegex(false);if(!phone){setFullnameError(false);setEmailError(false);setPhoneError(true);setAddressError(false);return;}else{setFullnameError(false);setEmailError(false);setPhoneError(false);setAddressError(false);if(!address){setFullnameError(false);setEmailError(false);setPhoneError(false);setAddressError(true);}else{var sendMail=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,query,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params={to:email,fullname:fullname,phone:phone,address:address,idUser:localStorage.getItem('id_user')};query='?'+queryString.stringify(params);_context2.next=4;return CheckoutAPI.postEmail(query);case 4:response=_context2.sent;console.log(response);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function sendMail(){return _ref2.apply(this,arguments);};}();sendMail();setLoad(!load);}}}}}};//Hàm này bắt đầu gửi Email xác nhận đơn hàng\nuseEffect(function(){if(load){var data=localStorage.getItem('id_user');// Gửi socket lên server\nsocket.emit('send_order',data);//Dùng setTimeout delay 3s\n//Sau 4s nó sẽ thực hiện\nsetTimeout(function(){setSuccess(!success);setLoad(!load);},4000);}},[load]);var onChangeName=function onChangeName(e){setFullname(e.target.value);};var onChangeEmail=function onChangeEmail(e){setEmail(e.target.value);};var onChangePhone=function onChangePhone(e){setPhone(e.target.value);};var onChangeAddress=function onChangeAddress(e){setAddress(e.target.value);};function validateEmail(email){var re=/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase());}return/*#__PURE__*/_jsxs(\"div\",{children:[load&&/*#__PURE__*/_jsx(\"div\",{className:\"wrapper_loader\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loader\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"section\",{className:\"py-5 bg-light\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row px-4 px-lg-5 py-lg-4 align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"h2 text-uppercase mb-0\",children:\"Checkout\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6 text-lg-right\",children:/*#__PURE__*/_jsx(\"nav\",{\"aria-label\":\"breadcrumb\",children:/*#__PURE__*/_jsxs(\"ol\",{className:\"breadcrumb justify-content-lg-end mb-0 px-0\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item\",children:/*#__PURE__*/_jsx(\"a\",{href:\"index.html\",children:\"Home\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item\",children:/*#__PURE__*/_jsx(\"a\",{href:\"cart.html\",children:\"Cart\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item active\",\"aria-current\":\"page\",children:\"Checkout\"})]})})})]})})}),!success&&/*#__PURE__*/_jsxs(\"section\",{className:\"py-5\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"h5 text-uppercase mb-4\",children:\"Billing details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-8\",children:/*#__PURE__*/_jsx(\"form\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-small text-uppercase\",htmlFor:\"Fullname\",children:\"Full Name:\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",value:fullname,onChange:onChangeName,type:\"text\",placeholder:\"Enter Your Full Name Here!\"}),fullnameError&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Full Name!\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"text-small text-uppercase\",htmlFor:\"Email\",children:[\"Email:\",' ']}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",value:email,onChange:onChangeEmail,type:\"text\",placeholder:\"Enter Your Email Here!\"}),emailError&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Email!\"}),emailRegex&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Incorrect Email Format\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"text-small text-uppercase\",htmlFor:\"Phone\",children:[\"Phone Number:\",' ']}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",value:phone,onChange:onChangePhone,type:\"text\",placeholder:\"Enter Your Phone Number Here!\"}),phoneError&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Phone Number!\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"text-small text-uppercase\",htmlFor:\"Address\",children:[\"Address:\",' ']}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",value:address,onChange:onChangeAddress,type:\"text\",placeholder:\"Enter Your Address Here!\"}),addressError&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Address!\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-12 form-group\",children:/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-dark\",style:{color:'white'},type:\"submit\",onClick:handlerSubmit,children:\"Place order\"})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card border-0 rounded-0 p-lg-4 bg-light\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-uppercase mb-4\",children:\"Your order\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-unstyled mb-0\",children:[carts&&carts.map(function(value){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"small font-weight-bold\",children:value.productId.name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-muted small\",children:[convertMoney(value.productId.price),\" VND x\",' ',value.quantity]})]}),/*#__PURE__*/_jsx(\"li\",{className:\"border-bottom my-2\"})]},value.productId._id);}),/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-uppercase small font-weight-bold\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[convertMoney(total),\" VND\"]})]})]})]})})})]})]}),success&&/*#__PURE__*/_jsx(\"section\",{className:\"py-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-5\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"You Have Successfully Ordered!\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'1.2rem'},children:\"Please Check Your Email.\"})]})})]})]});}export default Checkout;","map":{"version":3,"sources":["D:/Documents/node/asm3/Frontend Assignment 03/src/Checkout/Checkout.jsx"],"names":["React","useEffect","useState","queryString","CartAPI","CheckoutAPI","convertMoney","io","socket","Checkout","props","carts","setCarts","total","setTotal","fullname","setFullname","fullnameError","setFullnameError","email","setEmail","emailError","setEmailError","emailRegex","setEmailRegex","phone","setPhone","phoneError","setPhoneError","address","setAddress","addressError","setAddressError","success","setSuccess","load","setLoad","localStorage","getItem","fetchData","params","idUser","query","stringify","getCarts","response","console","log","data","products","getTotal","length","window","location","replace","sub_total","sum_total","map","value","parseInt","productId","price","quantity","handlerSubmit","validateEmail","sendMail","to","postEmail","emit","setTimeout","onChangeName","e","target","onChangeEmail","onChangePhone","onChangeAddress","re","test","String","toLowerCase","color","name","_id","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport queryString from 'query-string';\nimport CartAPI from '../API/CartAPI';\nimport CheckoutAPI from '../API/CheckoutAPI';\nimport convertMoney from '../convertMoney';\nimport './Checkout.css';\n\nimport io from 'socket.io-client';\nconst socket = io('http://localhost:5000');\n\nfunction Checkout(props) {\n  const [carts, setCarts] = useState([]);\n\n  const [total, setTotal] = useState(0);\n\n  const [fullname, setFullname] = useState('');\n  const [fullnameError, setFullnameError] = useState(false);\n\n  const [email, setEmail] = useState('');\n  const [emailError, setEmailError] = useState(false);\n\n  const [emailRegex, setEmailRegex] = useState(false);\n\n  const [phone, setPhone] = useState('');\n  const [phoneError, setPhoneError] = useState(false);\n\n  const [address, setAddress] = useState('');\n  const [addressError, setAddressError] = useState(false);\n\n  const [success, setSuccess] = useState(false);\n\n  const [load, setLoad] = useState(false);\n\n  //Hàm này dùng để gọi API và render số sản phẩm\n  useEffect(() => {\n    if (localStorage.getItem('id_user')) {\n      const fetchData = async () => {\n        const params = {\n          idUser: localStorage.getItem('id_user'),\n        };\n\n        const query = '?' + queryString.stringify(params);\n\n        const response = await CartAPI.getCarts(query);\n\n        console.log(response);\n\n        setCarts(response.data.products);\n\n        getTotal(response.data.products);\n\n        if (response.data.products.length === 0) {\n          window.location.replace('/cart');\n        }\n      };\n\n      fetchData();\n    }\n  }, []);\n\n  //Hàm này dùng để tính tổng tiền carts\n  function getTotal(carts) {\n    let sub_total = 0;\n\n    const sum_total = carts.map((value) => {\n      return (sub_total +=\n        parseInt(value.productId.price) * parseInt(value.quantity));\n    });\n\n    setTotal(sub_total);\n  }\n\n  //Check Validation\n  const handlerSubmit = () => {\n    if (!fullname) {\n      setFullnameError(true);\n      setEmailError(false);\n      setPhoneError(false);\n      setAddressError(false);\n      return;\n    } else {\n      if (!email) {\n        setFullnameError(false);\n        setEmailError(true);\n        setPhoneError(false);\n        setAddressError(false);\n        return;\n      } else {\n        setPhoneError(false);\n        setAddressError(false);\n        setFullnameError(false);\n\n        if (!validateEmail(email)) {\n          setEmailRegex(true);\n          setFullnameError(false);\n          setEmailError(false);\n          setPhoneError(false);\n          setAddressError(false);\n          return;\n        } else {\n          setEmailRegex(false);\n\n          if (!phone) {\n            setFullnameError(false);\n            setEmailError(false);\n            setPhoneError(true);\n            setAddressError(false);\n            return;\n          } else {\n            setFullnameError(false);\n            setEmailError(false);\n            setPhoneError(false);\n            setAddressError(false);\n\n            if (!address) {\n              setFullnameError(false);\n              setEmailError(false);\n              setPhoneError(false);\n              setAddressError(true);\n            } else {\n              const sendMail = async () => {\n                const params = {\n                  to: email,\n                  fullname: fullname,\n                  phone: phone,\n                  address: address,\n                  idUser: localStorage.getItem('id_user'),\n                };\n\n                const query = '?' + queryString.stringify(params);\n\n                const response = await CheckoutAPI.postEmail(query);\n\n                console.log(response);\n              };\n\n              sendMail();\n\n              setLoad(!load);\n            }\n          }\n        }\n      }\n    }\n  };\n\n  //Hàm này bắt đầu gửi Email xác nhận đơn hàng\n  useEffect(() => {\n    if (load) {\n      const data = localStorage.getItem('id_user');\n\n      // Gửi socket lên server\n      socket.emit('send_order', data);\n\n      //Dùng setTimeout delay 3s\n      //Sau 4s nó sẽ thực hiện\n      setTimeout(() => {\n        setSuccess(!success);\n        setLoad(!load);\n      }, 4000);\n    }\n  }, [load]);\n\n  const onChangeName = (e) => {\n    setFullname(e.target.value);\n  };\n\n  const onChangeEmail = (e) => {\n    setEmail(e.target.value);\n  };\n\n  const onChangePhone = (e) => {\n    setPhone(e.target.value);\n  };\n\n  const onChangeAddress = (e) => {\n    setAddress(e.target.value);\n  };\n\n  function validateEmail(email) {\n    const re =\n      /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  }\n\n  return (\n    <div>\n      {load && (\n        <div className=\"wrapper_loader\">\n          <div className=\"loader\"></div>\n        </div>\n      )}\n\n      <div className=\"container\">\n        <section className=\"py-5 bg-light\">\n          <div className=\"container\">\n            <div className=\"row px-4 px-lg-5 py-lg-4 align-items-center\">\n              <div className=\"col-lg-6\">\n                <h1 className=\"h2 text-uppercase mb-0\">Checkout</h1>\n              </div>\n              <div className=\"col-lg-6 text-lg-right\">\n                <nav aria-label=\"breadcrumb\">\n                  <ol className=\"breadcrumb justify-content-lg-end mb-0 px-0\">\n                    <li className=\"breadcrumb-item\">\n                      <a href=\"index.html\">Home</a>\n                    </li>\n                    <li className=\"breadcrumb-item\">\n                      <a href=\"cart.html\">Cart</a>\n                    </li>\n                    <li className=\"breadcrumb-item active\" aria-current=\"page\">\n                      Checkout\n                    </li>\n                  </ol>\n                </nav>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {!success && (\n          <section className=\"py-5\">\n            <h2 className=\"h5 text-uppercase mb-4\">Billing details</h2>\n            <div className=\"row\">\n              <div className=\"col-lg-8\">\n                <form>\n                  <div className=\"row\">\n                    <div className=\"col-lg-12 form-group\">\n                      <label\n                        className=\"text-small text-uppercase\"\n                        htmlFor=\"Fullname\"\n                      >\n                        Full Name:\n                      </label>\n                      <input\n                        className=\"form-control form-control-lg\"\n                        value={fullname}\n                        onChange={onChangeName}\n                        type=\"text\"\n                        placeholder=\"Enter Your Full Name Here!\"\n                      />\n                      {fullnameError && (\n                        <span className=\"text-danger\">\n                          * Please Check Your Full Name!\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"col-lg-12 form-group\">\n                      <label\n                        className=\"text-small text-uppercase\"\n                        htmlFor=\"Email\"\n                      >\n                        Email:{' '}\n                      </label>\n                      <input\n                        className=\"form-control form-control-lg\"\n                        value={email}\n                        onChange={onChangeEmail}\n                        type=\"text\"\n                        placeholder=\"Enter Your Email Here!\"\n                      />\n                      {emailError && (\n                        <span className=\"text-danger\">\n                          * Please Check Your Email!\n                        </span>\n                      )}\n                      {emailRegex && (\n                        <span className=\"text-danger\">\n                          * Incorrect Email Format\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"col-lg-12 form-group\">\n                      <label\n                        className=\"text-small text-uppercase\"\n                        htmlFor=\"Phone\"\n                      >\n                        Phone Number:{' '}\n                      </label>\n                      <input\n                        className=\"form-control form-control-lg\"\n                        value={phone}\n                        onChange={onChangePhone}\n                        type=\"text\"\n                        placeholder=\"Enter Your Phone Number Here!\"\n                      />\n                      {phoneError && (\n                        <span className=\"text-danger\">\n                          * Please Check Your Phone Number!\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"col-lg-12 form-group\">\n                      <label\n                        className=\"text-small text-uppercase\"\n                        htmlFor=\"Address\"\n                      >\n                        Address:{' '}\n                      </label>\n                      <input\n                        className=\"form-control form-control-lg\"\n                        value={address}\n                        onChange={onChangeAddress}\n                        type=\"text\"\n                        placeholder=\"Enter Your Address Here!\"\n                      />\n                      {addressError && (\n                        <span className=\"text-danger\">\n                          * Please Check Your Address!\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"col-lg-12 form-group\">\n                      <a\n                        className=\"btn btn-dark\"\n                        style={{ color: 'white' }}\n                        type=\"submit\"\n                        onClick={handlerSubmit}\n                      >\n                        Place order\n                      </a>\n                    </div>\n                  </div>\n                </form>\n              </div>\n              <div className=\"col-lg-4\">\n                <div className=\"card border-0 rounded-0 p-lg-4 bg-light\">\n                  <div className=\"card-body\">\n                    <h5 className=\"text-uppercase mb-4\">Your order</h5>\n                    <ul className=\"list-unstyled mb-0\">\n                      {carts &&\n                        carts.map((value) => (\n                          <div key={value.productId._id}>\n                            <li className=\"d-flex align-items-center justify-content-between\">\n                              <strong className=\"small font-weight-bold\">\n                                {value.productId.name}\n                              </strong>\n                              <br></br>\n                              <span className=\"text-muted small\">\n                                {convertMoney(value.productId.price)} VND x{' '}\n                                {value.quantity}\n                              </span>\n                            </li>\n                            <li className=\"border-bottom my-2\"></li>\n                          </div>\n                        ))}\n                      <li className=\"d-flex align-items-center justify-content-between\">\n                        <strong className=\"text-uppercase small font-weight-bold\">\n                          Total\n                        </strong>\n                        <span>{convertMoney(total)} VND</span>\n                      </li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n        )}\n\n        {success && (\n          <section className=\"py-5\">\n            <div className=\"p-5\">\n              <h1>You Have Successfully Ordered!</h1>\n              <p style={{ fontSize: '1.2rem' }}>Please Check Your Email.</p>\n            </div>\n          </section>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}